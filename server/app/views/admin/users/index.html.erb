<% content_for :title, "User Management" %>
<div class="container-fluid">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Users List</h5>
      <div>
        <%= form_with url: admin_users_path, method: :get, class: "d-flex", data: { turbo: false } do |f| %>
          <div class="input-group">
            <%= f.search_field :keyword, value: @keyword, class: "form-control", placeholder: "Search by name or email", aria: { label: "Search" } %>
            <button class="btn btn-outline-primary" type="submit">
              <i class="bi bi-search"></i> Search
            </button>
            <% if @keyword.present? %>
              <%= link_to "Clear", admin_users_path, class: "btn btn-outline-secondary" %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @users.each do |user| %>
              <tr>
                <td><%= user.id %></td>
                <td><%= user.name || "N/A" %></td>
                <td><%= user.email %></td>
                <td>
                  <% if user.status.present? %>
                    <span class="badge <%= user.status == 'active' ? 'bg-success' : user.status == 'invited' ? 'bg-warning' : 'bg-danger' %>">
                      <%= user.status.to_s.capitalize %>
                    </span>
                  <% else %>
                    <span class="badge bg-secondary">Unknown</span>
                  <% end %>
                </td>
                <td><%= user.created_at.strftime('%b %d, %Y') %></td>
                <td>
                  <%= link_to 'View', admin_user_path(user), class: 'btn btn-sm btn-info' %>
                  <%#= link_to 'Edit', edit_admin_user_path(user), class: 'btn btn-sm btn-primary' %>
                  <%= link_to 'Reset Password', admin_users_reset_password_path(user.id), class: 'btn btn-sm btn-warning' %>
                  <%= link_to "Simulate Login", simulate_request_login_admin_user_path(user), class: "btn btn-success me-2", data: { turbo: false }, target: "_blank" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
    <div class="card-footer">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <% start_count = (@users.current_page - 1) * @users.limit_value + 1 %>
          <% end_count = [@users.current_page * @users.limit_value, @users.total_count].min %>
          Showing <strong><%= start_count %>-<%= end_count %></strong> of <strong><%= @users.total_count %></strong> users
          <% if @keyword.present? %>
            <span class="ms-2 badge bg-info">Search: "<%= @keyword %>" <a href="<%= admin_users_path %>" class="text-white"><i class="bi bi-x"></i></a></span>
          <% end %>
        </div>
        <div>
          <% if @users.total_pages > 1 %>
            <nav aria-label="Page navigation">
              <ul class="pagination pagination-sm justify-content-end mb-0">
                <%= paginate @users, 
                           params: { keyword: params[:keyword] }, 
                           outer_window: 1,
                           inner_window: 2 %>
              </ul>
            </nav>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
